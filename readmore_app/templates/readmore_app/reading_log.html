{% extends parent_template|default:"base.html" %}
{% load static %}

{% block title %}
Readmore - Reading Log
{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; width: 80vw;">
<a style="margin-top: 50px; position: absolute;" href="{% url 'readmore_app:profile' user.id %}">Back To User Profile</a>
<div id="reading_log">
    <center>
    <h1>My Reading Log</h1>
    </center>
    <form action="{% url 'readmore_app:reading_log' %}" method="post">
    {% csrf_token %}
        <table>
            {{ form.as_table }}
            <tr>
                <td style="text-align: left;" colspan=2><input type="submit" name="Add Book to Reading Log"></td>
            </tr>
        </table>

    </form>
	{% if reading_log %}
    <table class="table" id="club_library_table">
        <tr id="row" style="">
        {% for shortlist in reading_log %}
            {% for book in shortlist %}
            <td id="reading_log_book{{ book.id }}" style="width: 20%;">
                <table>
                <tr>
                    <a class="book_search_link" href="{% url 'readmore_app:view_book' book.isbn13 %}"><td rowspan=3><img src="{{ book.small_thumbnail }}" alt="{{ book.title }} Cover Image" /></td></a>
                    <td colspan=2>
                    <p style="font-size:18px;">{{ book.title }}</p>
                    </td>

                </tr>
                <tr>
                    <td style="font-size:12px;">
                        Author{{ book.authors|length|pluralize:"s" }}
                    </td>
                    <td>
                        <p style="font-size:12px;">
                        {% for author in book.authors %}
                        <span style="font-size:12px;">{{ author }}</span>
                        </p>
                        {% endfor %}
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>
                            <button onclick="delete_user_library_book('{{ book.id }}');">Delete Book</button>
                        </p>
                    </td>
                </tr>
                </table>
            </td>
            {% endfor %}
        {% endfor %}
        </tr>
    </table>
	{% else %}
	<h3>No Books Found</h3>
	{% endif %}
</div>
</div>
{% endblock %}


{% block js %}
function delete_user_library_book(book_id) {
    const td = document.getElementById("reading_log_book" + book_id);
    const xhrremoveuserbook = new XMLHttpRequest();
    const row = document.getElementById('row');
    const reading_log = document.getElementById('reading_log');
    const table = document.getElementById("club_library_table");
    xhrremoveuserbook.onload = function(){
        td.parentNode.removeChild(td);
        let hasChild = false;
        if (row.childElementCount == 0) {
            table.parentNode.removeChild(table);
            reading_log.innerHTML += `<h3>No Books Found</h3>`;
        }
    }
    xhrremoveuserbook.open("GET", `/readmore/ajax/remove_from_user_library/${book_id}/`);
    xhrremoveuserbook.send();
    
}
{% endblock %}
